# BMP to 4bpp Array Converter

Program do konwersji plików BMP na różne formaty tablic zawierających bajty obrazka w formacie 4bpp (4 bits per pixel).

## Cel projektu

Program umożliwia konwersję obrazów BMP na dane w formacie 4bpp (4 bits per pixel), które mogą być wyświetlane na wyświetlaczach LCD z paletą 16 odcieni. Każdy bajt zawiera 2 piksele, co pozwala na efektywne przechowywanie danych graficznych.

### Przykład konwersji

**Obraz wejściowy (BMP):**
![Obraz wejściowy](img/sample-image.bmp)

**Rezultat na wyświetlaczu LCD (16 odcieni żółtego):**
![Rezultat na LCD](img/sample-image.png)

### Jak osiągnąć ten rezultat

1. **Konwersja podstawowa** - zobacz sekcję [Użycie](#użycie):
   ```bash
   ./bmp_to_4bpp img/sample-image.bmp
   ```

2. **Format tablicy C** - zobacz sekcję [Formaty wyjściowe - Tablica C](#1-tablica-c-h---domyślny):
   ```bash
   ./bmp_to_4bpp -c img/sample-image.bmp image_data.h
   ```

3. **Format assemblera** - zobacz sekcję [Formaty wyjściowe - Format assemblera](#3-format-assemblera-inc):
   ```bash
   ./bmp_to_4bpp -a img/sample-image.bmp sprite.inc
   ```

4. **Format MASM** - zobacz sekcję [Formaty wyjściowe - Format MASM](#4-format-masm-z-makrem-array-inc):
   ```bash
   ./bmp_to_4bpp -aa -n image_data img/sample-image.bmp sprite.inc
   ```

## Opis

Program konwertuje obrazy BMP na różne formaty wyjściowe, gdzie każdy bajt zawiera 2 piksele w formacie 4bpp. Obraz jest automatycznie konwertowany do skali szarości i skalowany do 16 odcieni (0-15).

## Kompilacja

### Linux/macOS (Makefile)
```bash
make
```

### Windows (Visual Studio)
Otwórz `bmp_to_4bpp.sln` w Visual Studio i zbuduj projekt (Ctrl+Shift+B).

Dostępne konfiguracje:
- Debug/Release dla x86 i x64
- Platform Toolset: v142 (Visual Studio 2019)

## Użycie

```bash
./bmp_to_4bpp [OPTIONS] input.bmp [output_file]
```

### Argumenty:
- `input.bmp` - plik wejściowy BMP (24-bit lub 32-bit)
- `output_file` - opcjonalny plik wyjściowy (domyślnie: image_data.h)

### Opcje:
- `-h, --horizontal` - Skanuj poziomo (wierszami) (domyślnie)
- `-v, --vertical` - Skanuj pionowo (kolumnami)
- `-l, --little-endian` - Kolejność pikseli little endian (domyślnie)
- `-b, --big-endian` - Kolejność pikseli big endian
- `-c, --c-array` - Format tablicy C (.h) (domyślnie)
- `-r, --raw-data` - Format surowych danych (.hex)
- `-a, --assembler` - Format assemblera (.inc)
- `-aa, --assembler-array` - Format MASM z makrem .array (.inc)
- `-p, --progmem` - Dodaj słowo kluczowe PROGMEM do tablic C
- `-n, --name NAME` - Ustaw nazwę tablicy (domyślnie: image_data)
- `--help` - Pokaż pomoc

## Formaty wyjściowe

### 1. Tablica C (.h) - domyślny
Pełna tablica C z deklaracją:
```c
// Generated by BMP to 4bpp Array Converter v1.0 2025-09-28 (c) PTODT 20250928T1006
// Image size: 256x64
const unsigned char image_data[8192] = {
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, ...
};
```

Z PROGMEM:
```c
const unsigned char image_data[8192] PROGMEM = {
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, ...
};
```

### 2. Surowe dane (.hex)
Tylko dane bez deklaracji:
```
FF FF FF FF FF FF FF FF FF FF FF FF FF FF FE DE
DD DD DD DD CF FF FF FF FF FF FF FF FF FF FF FF
...
```

### 3. Format assemblera (.inc)
Format dla assemblera:
```
; Generated by BMP to 4bpp Array Converter v1.0 2025-09-28 (c) PTODT 20250928T1006
; Image size: 256x64
image_data:
    .db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
    .db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE, 0xDE
    ...
```

### 4. Format MASM z makrem .array (.inc)
Format dla MASM assemblera z makrem .array:
```
; Generated by BMP to 4bpp Array Converter v1.0 2025-09-28 (c) PTODT 20250928T1006
; Image size: 256x64
.array image_data[8192].byte
 $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FE, $DE
$FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FF, $FE, $DE
...
.enda
```

## Przykłady

```bash
# Domyślne ustawienia (tablica C, poziomo, little endian)
./bmp_to_4bpp test.bmp image_data.h

# Format surowych danych
./bmp_to_4bpp -r test.bmp data.hex

# Format assemblera
./bmp_to_4bpp -a test.bmp sprite.inc

# Format MASM z makrem .array
./bmp_to_4bpp -aa -n image_data test.bmp sprite.inc

# Tablica C z PROGMEM
./bmp_to_4bpp -p test.bmp progmem_data.h

# Skanowanie pionowe z big endian
./bmp_to_4bpp -v -b test.bmp vertical_big.h

# Niestandardowa nazwa tablicy
./bmp_to_4bpp -n my_sprite test.bmp sprite.h

# Kombinacja opcji
./bmp_to_4bpp -v -b -a -n sprite_data test.bmp sprite.inc

# Format MASM z niestandardową nazwą
./bmp_to_4bpp -aa -n MY_SPRITE test.bmp sprite.inc

# Pokaż pomoc
./bmp_to_4bpp --help
```

## Struktura plików

### Pliki źródłowe
- `bmp_to_4bpp.c` - główny plik źródłowy (logika główna)
- `bmp_reader.c` / `bmp_reader.h` - obsługa plików BMP
- `utils.c` / `utils.h` - funkcje pomocnicze (konwersja, pakowanie, zapis)
- `options.c` / `options.h` - obsługa argumentów wiersza poleceń
- `defs.h` - definicje typów i stałych

### Pliki kompilacji
- `Makefile` - dla Linux/macOS
- `bmp_to_4bpp.sln` - plik rozwiązania Visual Studio
- `bmp_to_4bpp.vcxproj` - plik projektu Visual Studio
- `bmp_to_4bpp.vcxproj.filters` - filtry plików w Solution Explorer
- `bmp_to_4bpp.vcxproj.user` - ustawienia użytkownika

### Dokumentacja
- `readme.md` - ten plik

## Wymagania

- **Linux/macOS**: Kompilator C99 (gcc)
- **Windows**: Visual Studio 2019 lub nowszy
- Obsługa plików BMP 24-bit i 32-bit

## Licencja

MIT - zobacz nagłówki plików źródłowych dla szczegółów.

## Autor

Michal Kolodziejski (2:480/112.10)  
Copyright (c) PTODT <https://ptodt.org.pl>